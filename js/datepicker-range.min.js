Picker.Date.Range=new Class({Extends:Picker.Date,options:{getStartEndDate:function(t){return t.get("value").split("-").map(function(t){var e=Date.parse(t);return Date.isValid(e)?e:null}).clean()},setStartEndDate:function(t,e){t.set("value",e.map(function(t){return t.format(this.options.format)},this).join(" - "))},footer:!0,columns:3},getInputDate:function(t){if(t){var e=t.retrieve("datepicker:value");e&&e.length&&(e=e.map(Date.parse)),e&&e.length&&!e.some(function(t){return!Date.isValid(t)})||(e=this.options.getStartEndDate.call(this,t)).length&&e.every(function(t){return Date.isValid(t)})||(e=[this.date]),1==e.length?this.date=this.startDate=this.endDate=e[0]:2==e.length&&(this.date=this.startDate=e[0],this.endDate=e[1])}},constructPicker:function(){this.parent();var t=this.footer,e=this;if(t){var n={click:function(){this.focus()},blur:function(){var t=Date.parse(this.get("value"));t.isValid&&(e[(this==a?"start":"end")+"Date"]=t),e.updateRangeSelection()},keydown:function(t){"enter"==t.key&&e.selectRange()}},a=this.startInput=new Element("input",{events:n}).inject(t);new Element("span",{text:" - "}).inject(t);this.endInput=new Element("input",{events:n}).inject(t);this.applyButton=new Element("button.apply",{text:Locale.get("DatePicker.apply_range"),events:{click:e.selectRange.pass([],e)}}).inject(t),this.cancelButton=new Element("button.cancel",{text:Locale.get("DatePicker.cancel"),events:{click:e.close.pass(!1,e)}}).inject(t)}},renderDays:function(){this.parent.apply(this,arguments),this.updateRangeSelection()},select:function(t){this.startDate&&(this.endDate==this.startDate||t>this.endDate)&&t>=this.startDate||(this.startDate=t),this.endDate=t,this.updateRangeSelection()},selectRange:function(){this.date=this.startDate;var t=[this.startDate,this.endDate],e=this.input;return this.options.setStartEndDate.call(this,e,t),e.store("datepicker:value",t.map(function(t){return t.strftime()})).fireEvent("change"),this.fireEvent("select",t,e),this.close(),this},updateRangeSelection:function(){var t=this.startDate,e=this.endDate||t;if(this.dateElements)for(var n=this.dateElements.length;n--;){var a=this.dateElements[n];a.time>=t&&a.time<=e?a.element.addClass("selected"):a.element.removeClass("selected")}var s=t.format(this.options.format),i=e.format(this.options.format);return this.startInput.set("value",s),this.endInput.set("value",i),this}});